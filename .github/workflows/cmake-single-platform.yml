# Auris v2.0 - ARM64 Syscall Tracer & Security Toolkit
# This workflow builds Auris on ARM64 using QEMU emulation
# Note: Auris is designed for ARM64 Linux and uses ARM64-specific ptrace features
name: Build Auris

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  BUILD_TYPE: Release

jobs:
  build-arm64:
    name: Build (ARM64)
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up QEMU for ARM64
      uses: docker/setup-qemu-action@v3
      with:
        platforms: arm64

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Build in ARM64 container
      run: |
        docker run --rm --platform linux/arm64 \
          -v ${{ github.workspace }}:/src \
          -w /src \
          arm64v8/debian:bookworm-slim \
          bash -c "
            apt-get update && \
            apt-get install -y build-essential cmake pkg-config \
              libcurl4-openssl-dev libssl-dev libjson-c-dev && \
            cmake -B build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }} -DBUILD_TESTS=OFF && \
            cmake --build build --config ${{ env.BUILD_TYPE }} && \
            echo 'Build successful!' && \
            file build/auris
          "

  # Also verify the code compiles on x86_64 (syntax check only - won't run)
  build-x86:
    name: Syntax Check (x86_64)
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          cmake \
          pkg-config \
          libcurl4-openssl-dev \
          libssl-dev \
          libjson-c-dev

    - name: Configure CMake
      run: cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}} -DBUILD_TESTS=OFF

    - name: Build
      run: cmake --build ${{github.workspace}}/build --config ${{env.BUILD_TYPE}}
      
    - name: Note
      run: |
        echo "Note: This x86_64 build is for syntax verification only."
        echo "Auris is designed for ARM64 Linux and uses ARM64-specific features."
        echo "The ARM64 build above is the primary build target."

